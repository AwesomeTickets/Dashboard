## 1.程序描述

### 1.1 意义
本项目是中山大学软件工程大三课程《系统分析与设计》大作业项目：线上电影购票系统。

### 1.2 技术特点
1.2.1 使用java开发，全面向对象。

1.2.2 提供院线RESTful接口，支持前端多样化。

1.2.3 后台部署分布式，支持高并发。

1.2.4 集成、部署使用docker容器，过程自动化，降低人力成本。

1.2.5 使用J2EE架构，Spring-SpringMVC-Hibernate框架。
- Spring框架提供了注解、AOP等，提高开发效率。
- SpringMVC轻量化，本后台接口服务并不需要渲染页面等。
- Hibernate提供了数据抽象，作为ORM框架提高了小规模服务开发迭代效率。

1.2.6 配置脱离运行代码，提高开发测试效率。

### 1.3 项目目录结构
```
- Ticekts-Server
	- src
		- main
			- java
				- com.awesometickets
					- business
						- entities
							- repositories
						- services
					- config
					- util
					- web
						- controller
							- response
						- interceptor
			- resources
			- webapp
				- WEB-INF
		- test

```

## 2.功能
作为院线API后台服务程序，提供院线接口供前端调用。
详见接口文档。

## 3.性能

### 3.1 每次请求应尽量在3秒内完成响应。
### 3.2 服务程序应当保持时刻在线。

## 4.输入项
详见接口文档。

## 5.输出项
详见接口文档。

## 6.算法

### 6.1 用户密码保存使用MD5单向加密，降低数据泄露风险。
```
	- src
		- main
			- java
				- com.awesometickets.business.services.UserService.digest()
```

## 7.流程逻辑

### 7.1 拦截器
7.1.1 缓存
```
	- src
		- main
			- java
				- com.awesometickets.web.interceptor.CacheInterceptor
```
所有请求首先经过缓存拦截器，如果请求在缓存中有，则直接返回内容。

### 7.2 接口路由
7.2.1 返回值
```
	- src
		- main
			- java
				- com.awesometickets.web.controller.response
```
- RestResponse：RESTful服务接口的基类，由LinkedHashMap继承而来，Spring可直接渲染为JSON对象返回。
- ErrorResponse：继承自RestResponse，当发生错误时返回，有code、info属性，用于错误提示。
- CollectionResponse：继承自RestResponse，用于返回集合。有count和data属性。
- ErrorStatus：定义了本服务所出现的所有错误类型及提示信息。

7.2.2 控制器
使用Spring注解容器Controller定义。
- RequestMapping注解：定义一条路径映射方法，可以通过属性设置定义路径、HTTP方法、返回值类型。
- PathVariable注解：可直接获取定义路径中的路径变量。
- RequestParam注解：可直接获取请求中的参数。
```
	- src
		- main
			- java
				- com.awesometickets.web.controller
```
- CinemaController：提供影院信息接口。
- CinemaHallCOntroller：提供影院内影厅信息的接口。
- MovieController：提供电影信息接口。
- MovieOnShowController：提供上映电影信息接口。
- SeatController：提供座位信息接口。
- SmsController：提供手机短信相关服务接口。
- TicketController：提供票务信息接口。
- UserController：提供用户服务接口，包括注册登录等。
- ViewController：提供返回页面接口。

### 7.3 工具
```
	- src
		- main
			- java
				- com.awesometickets.util
```
7.3.1 DateUtil
- 使用Calendar计算nextDate

7.3.2 LogUtil
- logReq方法传入logger和request对象，按照格式输出日志。

### 7.4 数据库
```
	- src
		- main
			- java
				- com.awesometickets.business.entities.repositories
```
7.4.1 CinemaHallRepository
- 通过cinemaHallId查找影厅信息，包括所在影院、影厅名。
- 通过cinemaHallId查找影厅座位情况。

7.4.2 CinemaRepository

7.4.3 MovieOnShowRepository
- 通过movieId、cinemaHallId、showDate、showTime查找上映电影。
- 通过movieId、showDates查找上映该电影的影院。
- 通过movieId、showDate、cinemaId查找某日上映电影。
- 通过movieId、showDate、cinemaId查找某日上映简介。

7.4.4 MovieRepository
- 通过status查找电影。
- 获取大海报的电影信息以及海报图片。
- 通过movieId获取电影详细信息。

7.4.5 SeatRepository
- 通过movieOnShowId和available查找可用/不可用座位
- 通过ticketId查找票中座位。
- 通过row、col、movieOnShowId查找特定座位信息。
- 通过phoneNum查找票务信息。

7.4.6 TicketRepository
- 通过票务码code查找票信息。
- 通过票务码code查找持票用户信息。

7.4.7 UserRepository
- 通过phoneNum查找用户。

## 8.存储分配

### 8.1 各表内容都存储在awesome_tickets数据库中。

### 8.2 拦截器缓存存储在Redis中。

## 9.注释设计
### 9.1 加在模块首部的注释
指明模块主要涉及业务范围。

### 9.2 加在各分枝点处的注释
指明方法传入参数、返回值，以及方法内部实现功能。

### 9.3 对使用的逻辑所加的注释
指明逻辑使用流程及原因。

## 10.限制条件

### 10.1 云服务器数量、性能有限，因此整体性能受到限制。
